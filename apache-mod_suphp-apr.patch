diff -urN suphp-0.5.2.org/src/apache2/mod_suphp.c suphp-0.5.2/src/apache2/mod_suphp.c
--- suphp-0.5.2.org/src/apache2/mod_suphp.c	2004-10-23 12:58:09.156787800 +0200
+++ suphp-0.5.2/src/apache2/mod_suphp.c	2004-10-23 12:59:23.461491768 +0200
@@ -56,7 +56,7 @@
         return -1;
        
     rv = apr_bucket_read(b, &bucket_data, &bucket_data_len, APR_BLOCK_READ);
-    if (!APR_STATUS_IS_SUCCESS(rv) || (bucket_data_len == 0))
+    if (rv != APR_SUCCESS || (bucket_data_len == 0))
     {
         return 0;
     }
@@ -524,7 +524,7 @@
             return rv;
         }
         
-        APR_BRIGADE_FOREACH(bucket, bb)
+	for(bucket = APR_BRIGADE_FIRST(bb); bucket != APR_BRIGADE_SENTINEL(bb); bucket = APR_BUCKET_NEXT(bucket))
         {
             const char *data;
             apr_size_t len;
@@ -595,7 +595,7 @@
             
             const char *buf;
             apr_size_t blen;
-            APR_BRIGADE_FOREACH(b, bb)
+	    for(b = APR_BRIGADE_FIRST(bb); b != APR_BRIGADE_SENTINEL(bb); b = APR_BUCKET_NEXT(b))
             {
                 if (APR_BUCKET_IS_EOS(b))
                     break;
@@ -616,7 +616,7 @@
             /* empty brigade (script output) */
             const char *buf;
             apr_size_t blen;
-            APR_BRIGADE_FOREACH(b, bb)
+	    for(b = APR_BRIGADE_FIRST(bb); b != APR_BRIGADE_SENTINEL(bb); b = APR_BUCKET_NEXT(b))
             {
                 if (APR_BUCKET_IS_EOS(b))
                     break;
